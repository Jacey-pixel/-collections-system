<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Collections System – Login</title>
<style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    body{min-height:100vh;display:flex;justify-content:center;align-items:center;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);font-family:Segoe UI,Arial,sans-serif}
    .card{background:#fff;padding:40px;border-radius:15px;box-shadow:0 15px 35px rgba(0,0,0,.1);width:100%;max-width:380px}
    h1{font-size:28px;color:#333;margin-bottom:6px;text-align:center}
    p.sub{font-size:14px;color:#666;text-align:center;margin-bottom:30px}
    .field{margin-bottom:20px}
    label{font-weight:600;color:#333;margin-bottom:8px;display:block}
    input{width:100%;padding:12px;border:2px solid #e1e1e1;border-radius:8px;font-size:15px;transition:border-color .3s}
    input:focus{outline:none;border-color:#667eea}
    button{width:100%;padding:12px;background:#667eea;color:#fff;border:none;border-radius:8px;font-weight:600;font-size:16px;cursor:pointer;transition:background .25s}
    button:hover{background:#5a6fd8}
    button:disabled{background:#ccc;cursor:not-allowed}
    .error{display:none;background:#fee2e2;color:#dc2626;padding:14px;border-radius:5px;font-size:14px;margin-top:15px}
    .success{display:none;background:#e8f5e8;color:#2e7d32;padding:14px;border-radius:5px;font-size:14px;margin-top:15px}
    .loading{display:none;text-align:center;color:#667eea;margin-top:15px;font-size:14px}
</style>
</head>
<body>
    <div class="card">
        <h1>Collections System</h1>
        <p class="sub">Login to access your dashboard</p>
        <form id="loginForm">
            <div class="field">
                <label for="email">Email</label>
                <input id="email" name="email" type="email" autocomplete="username" required>
            </div>
            <div class="field">
                <label for="password">Password</label>
                <input id="password" name="password" type="password" autocomplete="current-password" required>
            </div>
            <button id="loginBtn" type="submit">Login</button>
            <div id="errorBox" class="error"></div>
            <div id="successBox" class="success"></div>
            <div id="loadingBox" class="loading">Authenticating…</div>
        </form>
    </div>
<script>
(() => {
    const form = document.getElementById('loginForm');
    const btn = document.getElementById('loginBtn');
    const errBox = document.getElementById('errorBox');
    const successBox = document.getElementById('successBox');
    const loadBox = document.getElementById('loadingBox');
    const apiURL = 'https://eram-intl.app.n8n.cloud/webhook/login';
    const baseURL = 'https://jacey-pixel.github.io/-collections-system/';

    form.addEventListener('submit', async e => {
        e.preventDefault();
        errBox.style.display = 'none'; successBox.style.display = 'none';
        btn.disabled = true; loadBox.style.display = 'block';

        try {
            const res = await fetch(apiURL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: form.email.value.trim().toLowerCase(), password: form.password.value.trim() })
            });
            if (!res.ok) throw new Error(`Server error: ${res.status}`);
            
            const data = await res.json();
            if (!data.success) throw new Error(data.message || 'Invalid credentials');

            localStorage.setItem('sessionToken', data.token);
            localStorage.setItem('userInfo', JSON.stringify({ name: data.name, type: data.type, email: form.email.value.trim().toLowerCase() }));

            successBox.textContent = 'Login successful! Redirecting...';
            successBox.style.display = 'block';

            const target = data.type === 'SUPERVISOR' ? 'supervisor-dashboard.html' : 'dashboard.html';
            setTimeout(() => { window.location.href = baseURL + target; }, 1200);
        } catch (err) { errBox.textContent = err.message; errBox.style.display = 'block'; }
        finally { btn.disabled = false; loadBox.style.display = 'none'; }
    });
})();
</script>
</body>
</html>
